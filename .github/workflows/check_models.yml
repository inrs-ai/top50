name: Check Gemini Models

on:
  workflow_dispatch: # 允许你手动点击运行

jobs:
  list-models:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: pip install requests

      - name: Run check script
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: |
          python -c "
          import os
          import requests
          api_key = os.getenv('GEMINI_API_KEY')
          url = 'https://generativelanguage.googleapis.com/v1beta/models?key=' + api_key
          try:
              response = requests.get(url)
              if response.status_code == 200:
                  models = response.json().get('models', [])
                  print('\n' + '='*50)
                  print('AVAILABLE MODELS:')
                  for m in models:
                      if 'generateContent' in m.get('supportedGenerationMethods', []):
                          # 避免在 f-string 中使用转义符，直接使用 print 逗号分隔
                          print('-', m.get('name'))
                  print('='*50)
              else:
                  print('Error:', response.status_code)
                  print(response.text)
          except Exception as e:
              print('Exception:', str(e))
          "
